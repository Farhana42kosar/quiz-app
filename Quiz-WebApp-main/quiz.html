<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QuizMaster Quiz Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex flex-col">
    <div id="header"></div>

    <div class="flex-grow flex items-center justify-center">
      <div class="bg-white p-6 rounded-lg shadow-md max-w-lg w-full">
        <!-- Course Selection -->
        <div id="course-selection">
          <h2 class="text-xl font-bold mb-4 text-center">Select a Course</h2>
          <select id="course-dropdown" class="w-full mb-4 p-2 border rounded">
            <option value="" disabled selected>Choose a course</option>
            <option value="math">Mathematics</option>
            <option value="history">History</option>
            <option value="mythology">Indian Mythology</option>
          </select>
          <button
            id="startQuizBtn"
            onclick="startQuiz()"
            class="w-full py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300"
            disabled
          >
            Start Quiz
          </button>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-section" class="hidden">
          <div class="flex justify-between mb-2">
            <span>Question <span id="current">1</span> of <span id="total">5</span></span>
            <span class="text-red-500 font-bold">Time: <span id="time">20</span>s</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
            <div id="progress-bar" class="bg-blue-500 h-2.5 rounded-full" style="width: 20%"></div>
          </div>
          <div id="questions-container"></div>
          <div class="flex justify-between mt-4">
            <button id="prevBtn" onclick="showPreviousQuestion()" class="px-4 py-2 bg-blue-500 text-white rounded disabled:bg-gray-300">Previous</button>
            <button id="nextBtn" onclick="showNextQuestion()" class="px-4 py-2 bg-blue-500 text-white rounded disabled:bg-gray-300">Next</button>
          </div>
        </div>

        <!-- Result Section -->
        <div id="result" class="hidden text-center">
          <h2 class="text-xl font-bold mb-4">Quiz Results</h2>
          <p class="text-lg">Your Score: <span id="score">0</span>/5</p>
          <button onclick="resetQuiz()" class="mt-4 py-2 px-6 bg-blue-500 text-white rounded hover:bg-blue-600">Try Again</button>
          <div id="question-summary" class="mt-4 text-left"></div>
        </div>
      </div>
    </div>

    <div id="footer" class="mt-8"></div>

    <script>
      // Load header and footer
      fetch("header.html").then(res => res.text()).then(data => document.getElementById("header").innerHTML = data);
      fetch("footer.html").then(res => res.text()).then(data => document.getElementById("footer").innerHTML = data);

      let currentQuestion = 1;
      let totalQuestions = 5;
      let timeLeft = 20;
      let timer;
      let selectedCourse = "";
      let currentQuiz = [];
      let userAnswers = [];

      const quizQuestions = {
        math: [
          { question: "What is 2 + 2?", options: ["3", "4", "5", "6"], correctIndex: 1 },
          { question: "What is π to two decimal places?", options: ["3.14", "3.41", "3.12", "3.15"], correctIndex: 0 },
          { question: "Square root of 144?", options: ["12", "14", "10", "16"], correctIndex: 0 },
          { question: "7 × 8?", options: ["54", "56", "58", "52"], correctIndex: 1 },
          { question: "Sum of angles in triangle?", options: ["90°", "180°", "270°", "360°"], correctIndex: 1 },
        ],
        history: [
          { question: "When did WW2 end?", options: ["1943", "1944", "1945", "1946"], correctIndex: 2 },
          { question: "First US President?", options: ["Jefferson", "Washington", "Lincoln", "Adams"], correctIndex: 1 },
          { question: "Pyramids of Giza built by?", options: ["Romans", "Greeks", "Mayans", "Egyptians"], correctIndex: 3 },
          { question: "When did Titanic sink?", options: ["1910", "1912", "1914", "1916"], correctIndex: 1 },
          { question: "Queen Victoria ruled?", options: ["France", "Germany", "UK", "Spain"], correctIndex: 2 },
        ],
        mythology: [
          { question: "Preserver in Hindu Trinity?", options: ["Brahma", "Shiva", "Vishnu", "Indra"], correctIndex: 2 },
          { question: "Rama's story in?", options: ["Mahabharata", "Ramayana", "Gita", "Vedas"], correctIndex: 1 },
          { question: "Great archer Pandava?", options: ["Bhima", "Yudhishthira", "Arjuna", "Sahadeva"], correctIndex: 2 },
          { question: "Goddess of wealth?", options: ["Durga", "Saraswati", "Lakshmi", "Kali"], correctIndex: 2 },
          { question: "Monkey god with Rama?", options: ["Garuda", "Hanuman", "Kubera", "Nandi"], correctIndex: 1 },
        ],
      };

      document.getElementById("course-dropdown").addEventListener("change", function () {
        selectedCourse = this.value;
        document.getElementById("startQuizBtn").disabled = false;
      });

      function startQuiz() {
        document.getElementById("course-selection").classList.add("hidden");
        document.getElementById("quiz-section").classList.remove("hidden");
        currentQuiz = quizQuestions[selectedCourse];
        userAnswers = new Array(currentQuiz.length).fill(null);
        totalQuestions = currentQuiz.length;
        document.getElementById("total").textContent = totalQuestions;
        generateQuestions();
        setTimeout(() => showQuestion(1), 50);
        startTimer();
      }

      function generateQuestions() {
        const container = document.getElementById("questions-container");
        container.innerHTML = "";
        currentQuiz.forEach((q, idx) => {
          const qDiv = document.createElement("div");
          qDiv.id = `question${idx + 1}`;
          qDiv.classList.add(idx === 0 ? "block" : "hidden");
          qDiv.innerHTML = `
            <h3 class="text-lg font-semibold mb-3">${q.question}</h3>
            ${q.options
              .map(
                (opt, i) => `
              <label class="block mb-2 p-2 bg-gray-100 rounded cursor-pointer hover:bg-blue-100 hover:scale-105 transition-transform duration-200">
                <input type="radio" name="q${idx}" value="${i}" class="mr-2"> ${opt}
              </label>`
              )
              .join("")}
            <p id="lock-msg-${idx}" class="text-red-500 hidden mt-2 text-sm">Time's up! Question locked.</p>
          `;
          container.appendChild(qDiv);

          // Handle selection
          qDiv.querySelectorAll(`input[name="q${idx}"]`).forEach((radio) => {
            radio.addEventListener("change", (e) => {
              userAnswers[idx] = parseInt(e.target.value);
            });
          });
        });
      }

      function showQuestion(num) {
        for (let i = 1; i <= totalQuestions; i++) {
          document.getElementById(`question${i}`).classList.add("hidden");
        }
        document.getElementById(`question${num}`).classList.remove("hidden");
        document.getElementById("current").textContent = num;
        document.getElementById("prevBtn").disabled = num === 1;
        document.getElementById("nextBtn").textContent =
          num === totalQuestions ? "Submit" : "Next";
      }

      function showNextQuestion() {
        if (currentQuestion === totalQuestions) {
          clearInterval(timer);
          showResult();
          return;
        }
        currentQuestion++;
        showQuestion(currentQuestion);
        resetTimer();
      }

      function showPreviousQuestion() {
        if (currentQuestion > 1) {
          currentQuestion--;
          showQuestion(currentQuestion);
          resetTimer();
        }
      }

      function startTimer() {
        timeLeft = 20;
        document.getElementById("time").textContent = timeLeft;
        timer = setInterval(() => {
          timeLeft--;
          document.getElementById("time").textContent = timeLeft;
          if (timeLeft <= 0) {
            clearInterval(timer);
            document.getElementById(`lock-msg-${currentQuestion - 1}`).classList.remove("hidden");
            document.querySelectorAll(`#question${currentQuestion} input`).forEach((el) => (el.disabled = true));
          }
        }, 1000);
      }

      function resetTimer() {
        clearInterval(timer);
        startTimer();
        document.querySelectorAll(`#question${currentQuestion} input`).forEach((el) => (el.disabled = false));
        document.getElementById(`lock-msg-${currentQuestion - 1}`).classList.add("hidden");
      }

      function updateProgressBar() {
        const progress = (currentQuestion / totalQuestions) * 100;
        document.getElementById("progress-bar").style.width = `${progress}%`;
      }

      function showResult() {
        document.getElementById("quiz-section").classList.add("hidden");
        document.getElementById("result").classList.remove("hidden");

        let score = 0;
        currentQuiz.forEach((q, idx) => {
          if (userAnswers[idx] === q.correctIndex) score++;
        });
        document.getElementById("score").textContent = score;

        const summary = document.getElementById("question-summary");
        summary.innerHTML = "";
        currentQuiz.forEach((q, idx) => {
          const div = document.createElement("div");
          div.innerHTML = `<p class="mt-2"><strong>Q${idx + 1}:</strong> ${
            q.question
          }<br/><strong>Your Answer:</strong> ${
            q.options[userAnswers[idx]] || "None"
          } <br/><strong>Correct:</strong> ${q.options[q.correctIndex]}</p>`;
          summary.appendChild(div);
        });
      }

      function resetQuiz() {
        document.getElementById("result").classList.add("hidden");
        document.getElementById("course-selection").classList.remove("hidden");
        currentQuestion = 1;
        userAnswers = [];
        clearInterval(timer);
        document.getElementById("progress-bar").style.width = "0%";
        document.getElementById("course-dropdown").value = "";
        document.getElementById("startQuizBtn").disabled = true;
      }
    </script>
  </body>
</html>
